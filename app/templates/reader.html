{% extends "base.html" %}

{% block title %}{{ chapter.Title }} | {{ manga.TitleEn }} | MangaDex Clone{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/reader.css') }}">
{% endblock %}

{% block content %}
<div class="reader-container py-4 text-white">
    <div class="reader-header mb-3">
        <a href="{{ url_for('manga.manga_detail', manga_id=manga.MangaId) }}" class="btn btn-outline-light me-2">‚Üê Back
            to Manga</a>
        <h2 class="d-inline">{{ manga.TitleEn }} - Vol. {{ chapter.Volume or 'N/A' }} Ch. {{ chapter.ChapterNumber }}:
            {{ chapter.Title or 'Untitled' }}</h2>
    </div>

    <div id="long-strip" class="long-strip overflow-auto bg-dark p-3 rounded" style="height: 90vh;">
        <div id="loading-spinner" class="text-center py-5">
            <div class="spinner-border text-primary" role="status"></div>
            <p>Loading chapter...</p>
        </div>
        <div id="chapter-images" class="d-none">
            {% if image_urls %}
            {% for url in image_urls %}
            <img src="{{ url }}" alt="Page" class="chapter-page img-fluid mx-auto d-block mb-3" loading="lazy">
            {% endfor %}
            {% else %}
            <p class="text-danger text-center">Failed to load chapter images. Please try again.</p>
            {% endif %}
        </div>
    </div>

    <div class="reader-footer mt-3 d-flex justify-content-between align-items-center">
        <button id="prev-chapter" class="btn btn-secondary" {% if not has_prev %}disabled{% endif %}>Previous
            Chapter</button>
        <div class="progress w-50" style="height: 8px;">
            <div id="read-progress" class="progress-bar bg-primary" role="progressbar" style="width: 0%;"></div>
        </div>
        <button id="next-chapter" class="btn btn-primary" {% if not has_next %}disabled{% endif %}>Next Chapter</button>
    </div>
</div>

<script id="reader-data" type="application/json">
    {{ {
        "manga_id": manga.MangaId,
        "chapter_id": chapter.ChapterId,
        "lang": chapter.TranslatedLang,
        "has_prev": has_prev,
        "has_next": has_next,
        "is_authenticated": current_user.is_authenticated
    } | tojson }}
</script>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/reader.js') }}"></script>
{% endblock %}